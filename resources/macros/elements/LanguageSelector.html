<Macro name="LanguageSelector">
  <Param name="container" type="string" default="article"/>

  <ul class="LanguageSelector nav nav-pills bar">
    <Repeat for="{{ locale.getAvailableExt }}" as="i:loc">
      <Link id="btn-{{ loc.name }}"
            wrapper="li"
            script="setLang(event,'{{ loc.name }}')"
            label="{{ loc.label }}"
            active="{{ !i }}"/>
    </Repeat>
    <li class="disabled"><a href="javascript:nop()">$LANGUAGE</a></li>
  </ul>

  <Script name="LanguageSelector">
    var prevFocus = $ ();
    $ ('body').focusout (function (ev) {
      prevFocus = $ (ev.target);
    });
//    console.log ('Lang: {{ locale.available.0 }}');
    $ ('{{ @container }}')
      .attr ('lang', '{{ locale.available.0 }}')
      .find ('[lang]:first-of-type').show ();
    function setLang (ev, lang) {
      $ ('.LanguageSelector li').removeClass ('active');
      $ ('#btn-' + lang).addClass ('active');
      var c = $ ('{{ @container }}').attr ('lang', lang);
      c.find ('[lang]').hide ();
      c.find ('[lang="' + lang + '"]').show ();
      if (prevFocus.attr ('lang'))
        prevFocus.parent ().find ('[lang="' + lang + '"]').focus ();
      else prevFocus.focus ();
    }
  </Script>

</Macro>
